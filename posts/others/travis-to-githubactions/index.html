<!DOCTYPE html>
<html lang="en">
<title>Migrating my CI from Travis-CI to Github Actions - The stuff I do</title>

<meta name="description" content="A personal blog where I write about my side projects">
<meta name="robots" content="index,follow">
<meta name="author" content="statox">

<link rel="canonical" href="https://www.statox.fr/posts/others/travis-to-githubactions/">

<meta property="og:title" content="Migrating my CI from Travis-CI to Github Actions - The stuff I do">
<meta property="og:type" content="article">

<meta property="og:url" content="https://www.statox.fr/posts/others/travis-to-githubactions/">
<meta property="og:description" content="A personal blog where I write about my side projects">


<meta name="twitter:card" content="summary">

<meta name="twitter:url" content="https://www.statox.fr/posts/others/travis-to-githubactions/">
<meta name="twitter:title" content="Migrating my CI from Travis-CI to Github Actions - The stuff I do">
<meta name="twitter:description" content="A personal blog where I write about my side projects">



<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Migrating my CI from Travis-CI to Github Actions</title>
    <meta name="description" content="A personal blog where I write about my side projects">
    <meta name="keywords" content="statox blog">
    <meta property="og:title" content="The stuff I do">
    <meta property="og:url" content="https://www.statox.fr">
    <meta property="og:description" content="A personal blog where I write about my side projects">
    <meta property="og:type" content="website">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-fonts@1.1.1/fonts/inter.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css">

    
    <link rel="stylesheet" href="https://unpkg.com/prismjs@1.20.0/themes/prism-tomorrow.css">

    
    
    <style>
      .post-subheader{font-style:italic;color:#80837c}.post-date{font-family:var(--nc-font-mono)}@media screen and (max-width:600px){.post-date{display:none}}.note-tags{font-family:var(--nc-font-mono);opacity:.6}.not-found{text-align:center}#not-found-canvas{z-index:-1}a{text-decoration:none}pre{max-height:50rem}img{display:block;margin-left:auto;margin-right:auto}ul{list-style-type:circle}:root{--nc-tx-1:#546e7a;--nc-tx-2:#161d21;--nc-bg-1:#F4F4F4;--nc-bg-2:#eae8e8;--nc-bg-3:#FAFAFA;--nc-lk-1:#39ADB5;--nc-lk-2:#528aff;--nc-lk-tx:#F3F4F5;--nc-ac-1:#91B859;--nc-ac-tx:#FAFAFA;--nc-d-tx-1:#FFFFFF;--nc-d-tx-2:#B7B7B7;--nc-d-bg-1:#1E272C;--nc-d-bg-2:#161d21;--nc-d-bg-3:#263238;--nc-d-lk-1:#5E92FF;--nc-d-lk-2:#528aff;--nc-d-lk-tx:#2E3C43;--nc-d-ac-1:#C3E88D;--nc-d-ac-tx:#263238}@media (prefers-color-scheme:dark){:root{--nc-tx-1:var(--nc-d-tx-1);--nc-tx-2:var(--nc-d-tx-2);--nc-bg-1:var(--nc-d-bg-1);--nc-bg-2:var(--nc-d-bg-2);--nc-bg-3:var(--nc-d-bg-3);--nc-lk-1:var(--nc-d-lk-1);--nc-lk-2:var(--nc-d-lk-2);--nc-lk-tx:var(--nc-d-lk-tx);--nc-ac-1:var(--nc-d-ac-1);--nc-ac-tx:var(--nc-d-ac-tx)}}.nav-link{text-decoration:none}.nav-link.active{color:var(--nc-lk-2)}.hamburger{width:20px;height:2px;box-shadow:inset 0 0 0 32px,0 -6px,0 6px;margin:16px 7px;display:block}.topnav .icon{display:none}@media screen and (max-width:600px){.topnav span.nav-item:not(.active){display:none}.topnav span.icon{float:right;display:block;right:0;top:0;color:var(--nc-lk-1)}}@media screen and (max-width:600px){.topnav .nav-separator{display:none}}@media screen and (max-width:600px){.topnav.responsive{position:relative}.topnav.responsive span.icon{position:absolute;right:0;top:0;color:var(--nc-lk-2)}.topnav.responsive span{float:none;display:block;text-align:left}.topnav.responsive span.nav-item:not(.active){display:block}}.comment{--comment-bg:#e3efee;--comment-d-bg:#2a4765;margin-top:20px;padding:5px}.add-comment-btn{float:right}.comment-header{background:var(--comment-bg);padding-right:100px;padding-left:10px;border-top-left-radius:10px;border-top-right-radius:10px;padding:5px}.comment-content{border:2px solid var(--comment-bg);border-bottom-left-radius:10px;border-bottom-right-radius:10px}.comment-text{padding:10px}.comment-reactions{border-top:2px solid var(--comment-bg);padding:5px}.comment-reaction-item{padding-right:10px;padding-left:10px;border-right:2px solid var(--comment-bg)}@media (prefers-color-scheme:dark){.comment{--comment-bg:var(--comment-d-bg)}}kbd{--black-800:#242729;--white:#fff;--black-075:#e4e6e8;--black-300:#9fa6ad;--s-prose-line-height:1.5;--ff-sans:Arial,"Helvetica Neue",Helvetica,sans-serif}@media (prefers-color-scheme:dark){kbd{--black-800:#e7e8eb;--white:#2d2d2d;--black-075:#404345;--black-300:#7d848d}}kbd{display:inline-block;margin:0 .1em;padding:.1em .6em;font-family:var(--ff-sans);font-size:11px;line-height:var(--s-prose-line-height);color:var(--black-800);text-shadow:0 1px 0 var(--white);background-color:var(--black-075);border:1px solid var(--black-300);border-radius:3px;box-shadow:0 1px 1px rgba(12,13,14,.15),inset 0 1px 0 0 #fff;overflow-wrap:break-word}
    </style>

    
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">

    <script>
        function navbarToggle() {
            var x = document.getElementById("header-navbar");
            if (x.className === "topnav") {
                x.className += " responsive";
            } else {
                x.className = "topnav";
            }
        }
    </script>
</head>
<body>
    <header>
        <h1>The stuff I do</h1>
        <!--
           - Make the whole navbar clickable: It doesn't change anything on desktop
           - and makes it easier to open the menu on mobile
           -->
        <nav class="topnav" id="header-navbar" onclick="navbarToggle()">
            
            
            

            
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/">Home</a>
                    <i class="nav-separator"> ‚ô¢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/coolcovers/">Cool covers</a>
                    <i class="nav-separator"> ‚ô¢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/notes/">Notes</a>
                    <i class="nav-separator"> ‚ô¢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/about/">About</a>
                    <i class="nav-separator"> ‚ô¢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/social/">Social</a>
                    <i class="nav-separator"> ‚ô¢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/ring/">Ring</a>
                    <i class="nav-separator"> ‚ô¢ </i>
                </span>
                
                
                
                
                
                <span class="nav-item ">
                    <a class="nav-link " href="/feed.xml">RSS</a>
                    <i class="nav-separator"></i>
                </span>
                

                
                <span class="icon hamburger" onclick="navbarToggle()"> </span>
        </nav>
    </header>

    

    <div class="content-container">
        
<h2>Migrating my CI from Travis-CI to Github Actions</h2>
<p class="post-subheader">
    March 3, 2021
    - 1210 words
    - <span id="commentCounter"></span> comments

</p>
<p><a href="/">‚Üê Posts</a></p>

<p>Last November travis-ci <a href="https://blog.travis-ci.com/2020-11-02-travis-ci-new-billing" target="_blank" rel="noopener noreferrer">announced</a> a change in their pricing policy and that made me think about changing the CI environment I use for this website. After procrastinating on this topic for a few months I finally switched to <a href="https://github.com/features/actions" target="_blank" rel="noopener noreferrer">Github Actions</a> here's why and how I did it.</p>
<h3>Why changing?</h3>
<p>When I created this website I needed to setup a CI environment which would build the site using the static generator <a href="https://www.11ty.dev/" target="_blank" rel="noopener noreferrer">eleventy</a> before it gets deployed to Github Pages. I wanted a tool which would be:</p>
<ul>
<li>Free, because given the traffic on this website and the frequency of my commits I am not ready to put money in it;</li>
<li>Simple to use, because I figured out from my previous attempt at creating a blog that any friction in the creation of a post reduce drastically the chances that I'll write anything;</li>
<li>... And that's it.</li>
</ul>
<p>I had already used travis on a previous side project and I knew I could make something work pretty easily, especially because I had already an account set up. So I didn't give it too much thoughts and started creating my <code>.travis-ci.yml</code> file. And I have to say that after about 200 commits and 8 months of use I am still mostly satisfied this their service.</p>
<p>The only trouble I had with travis was a few months ago when they decided to enforce the <a href="https://docs.travis-ci.com/user/migrate/open-source-repository-migration" target="_blank" rel="noopener noreferrer">migration of all the open source repos from travis-ci.org to travis-ci.com</a>. I was annoyed because my build suddenly broke and I had to do the migration when I wasn't planning to do it. In their defense though the migration was announced since 2018 and I was in fault for not seeing the notices (or most likely forgetting about them). Also it was a minor pain as the migration was fairly straight forward.</p>
<p>With travis' new pricing policy each open source project has a finite amount of credits to use for their builds and once they are out of credit, the maintainer needs to email the travis team to ask for more credits. Considering how many credits I consumed since the change is effective I estimate that I would run out of credits in roughly 3 years: <em>Who has time to send an email every 3 years for their side project?</em> üôÑ</p>
<p>Ok, maybe that wouldn't be too much of an issue and I understand travis policy: In the end a company needs to make money to provide good products. But still, I was curious to experiment with Github Actions as they seem pretty popular currently, are better integrated with my project which is already hosted on Github and are completely free for what I want to do (<em>at least for now</em>).</p>
<h3>My CI workflow</h3>
<p>Before having a look at what changed let's see what my CI workflow needs to do.</p>
<p>It is a pretty straight forward process with three main steps:</p>
<ul>
<li>Run a script I made to check if I committed new posts with a reference to a Github issue that <a href="../comments/">I use to host comments</a> and create the corresponding issue if it doesn't exists;</li>
<li>Build the website using eleventy. This requires to checkout the last changes I made in my templates and run a npm script I have which execute eleventy and output the resulting HTML in a specified directory.</li>
<li>Commit this built HTML to a <code>gh-pages</code> branch on the repo which is then served by Github Pages.</li>
</ul>
<p>To do that I had a 20 lines <code>travis-ci.yml</code> file which looked like this:</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">language</span><span class="token punctuation">:</span> node_js<br><span class="token key atrule">node_js</span><span class="token punctuation">:</span><br>  <span class="token punctuation">-</span> <span class="token string">"stable"</span><br><span class="token key atrule">cache</span><span class="token punctuation">:</span><br>  <span class="token key atrule">directories</span><span class="token punctuation">:</span><br>  <span class="token punctuation">-</span> node_modules<br><br><span class="token key atrule">script</span><span class="token punctuation">:</span><br>    <span class="token comment"># Script to generate the issue in github used for comments</span><br>  <span class="token punctuation">-</span> npm run create<span class="token punctuation">-</span>issues <span class="token punctuation">-</span><span class="token punctuation">-</span> $GITHUB_TOKEN false<br>  <span class="token punctuation">-</span> npm run build<br><br><span class="token key atrule">deploy</span><span class="token punctuation">:</span><br>  <span class="token key atrule">provider</span><span class="token punctuation">:</span> pages<br>  <span class="token key atrule">skip_cleanup</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><br>  <span class="token key atrule">github_token</span><span class="token punctuation">:</span> $GITHUB_TOKEN<br>  <span class="token key atrule">keep_history</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><br>  <span class="token key atrule">on</span><span class="token punctuation">:</span><br>    <span class="token key atrule">branch</span><span class="token punctuation">:</span> master<br>  <span class="token key atrule">local_dir</span><span class="token punctuation">:</span> docs/<br>  <span class="token key atrule">fqdn</span><span class="token punctuation">:</span> www.statox.fr</code></pre>
<ul>
<li>
<p>The first 3 blocks are used to setup the environment which will run the workflow: NodeJS is used to run my npm scripts, and we cache the <code>node_modules</code> which is still bigger than I'd want it to be (but that's another topic I'll try to tackle later).</p>
</li>
<li>
<p>The <code>script</code> block simply runs my npm script which creates the issues on Github and the one I use to run eleventy against my sources and output the result in a <code>docs</code> directory.</p>
</li>
<li>
<p>Finally the <code>deploy</code> block uses travis' deploy built-in provider <a href="https://docs.travis-ci.com/user/deployment/pages/" target="_blank" rel="noopener noreferrer">&quot;pages&quot;</a> which commits the <code>docs</code> directory to the <code>gh-pages</code> branch.</p>
</li>
</ul>
<p>For all of this to work properly I had to <a href="https://docs.github.com/en/enterprise-server@2.22/github/authenticating-to-github/creating-a-personal-access-token" target="_blank" rel="noopener noreferrer">generate a personal access token</a>, store it in my repository secrets and copy it in my travis CI settings to be able to call the Github API to create issues and to commit my changes.</p>
<h3>What changed?</h3>
<p>Because my workflow is very simple (no tests to run, no linting, etc...) moving it to Github Actions was pretty quick, it took me about 20 minutes to get it to work.</p>
<p>First I got rid of the <code>.travis.yml</code> file to avoid running both pipelines at the same time and I created a <code>.github/workflow/deploy.yml</code> file:</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> deploy<br><span class="token key atrule">on</span><span class="token punctuation">:</span><br>  <span class="token key atrule">push</span><span class="token punctuation">:</span><br>    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> master <span class="token punctuation">]</span><br>  <span class="token key atrule">workflow_dispatch</span><span class="token punctuation">:</span><br><span class="token key atrule">jobs</span><span class="token punctuation">:</span><br>  <span class="token key atrule">deployment</span><span class="token punctuation">:</span><br>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest<br>    <span class="token key atrule">steps</span><span class="token punctuation">:</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> üîÄ Checkout<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2<br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> üö© Configure node<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'12'</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> üîß Install and build<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"><br>          npm ci<br>          npm run build</span><br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> üí¨ Create issues for comments<br>        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run create<span class="token punctuation">-</span>issues <span class="token punctuation">-</span><span class="token punctuation">-</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.ACCESS_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span> false<br>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> üöÄ Deploy<br>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> JamesIves/github<span class="token punctuation">-</span>pages<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>action@4.0.0<br>        <span class="token key atrule">with</span><span class="token punctuation">:</span><br>          <span class="token key atrule">branch</span><span class="token punctuation">:</span> gh<span class="token punctuation">-</span>pages <span class="token comment"># The branch the action should deploy to.</span><br>          <span class="token key atrule">folder</span><span class="token punctuation">:</span> docs <span class="token comment"># The folder the action should deploy.</span><br>          <span class="token key atrule">token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.ACCESS_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>
<p>The <code>name</code> block is only to set up the name of the action which will be shown in the UI</p>
<p><img src="../../../images/github_workflow.png" alt="deploy workflow"></p>
<ul>
<li>
<p>The <code>on</code> blocks defines when the workflow is ran. I want to deploy every time I push something to the <code>master</code> branch and I also added the <code>workflow_dispatch</code> directive which create the <code>Run workflow</code> button in the UI to trigger it manually. I don't know if I'll ever need it but it doesn't hurt to have it.</p>
</li>
<li>
<p>The <code>jobs</code> block defines the different steps will will be executed (<a href="https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions#the-components-of-github-actions" target="_blank" rel="noopener noreferrer">Github's doc</a> explain that clearly) and that's where I needed to recreate what was happening on travis.</p>
</li>
<li>
<p>The <code>checkout</code> and <code>setup-node</code> built-in actions setup the environment (<code>git checkout</code> the <code>master</code> branch and install node 12 with npm).</p>
</li>
<li>
<p>The <code>üîß Install and build</code> step pulls the npm dependencies (which was done automatically on travis) and run my build script. And the <code>üí¨ Create issues for comments</code> step runs my custom script for issues.</p>
</li>
<li>
<p>Finally I use an action <a href="https://github.com/marketplace/actions/deploy-to-github-pages" target="_blank" rel="noopener noreferrer">from the action market place</a> to commit my build to my <code>gh-pages</code> branch which is still served automatically by Github.</p>
</li>
</ul>
<p>Note that the main difference here compared to the travis configuration is that my access token was already in the secrets of my repository so I could access it directly with <code>${{ secrets.ACCESS_TOKEN }}</code> without additional config.</p>
<h3>Takeaway</h3>
<p>My experience with switching my CI to Github Actions has been pretty positive. The whole process is very well documented by Github, there are a lot of actions available on the market place which &quot;just work&quot;, and for now it's completely free for my project.</p>
<p>Even if that means relying even more on a Microsoft product -which I'm not exactly happy about- that is easily counterbalanced by the how easy to use it is.</p>


<p><a href="/">‚Üê Posts</a></p>

<hr>
<comments>
    <h3>Comments</h3>
    <a class="add-comment-btn" href="https://github.com/statox/blog-comments/issues/22#new_comment_field"  target="_blank" rel="noopener noreferrer">
        <button>Comment on Github</button>
    </a>
    <br>
</comments>

<script type="text/javascript" src="/scripts/githubComments.js"></script>
<script type="text/javascript">
    setupCommentsInPage(22);
</script>

    </div>

    <script data-goatcounter="https://statoxblog.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    <script async defer src="https://api.newcss.net/latest.js"></script>
    <noscript><img src="https://api.newcss.net/noscript.gif" alt=""></noscript>
</body>
</html>
