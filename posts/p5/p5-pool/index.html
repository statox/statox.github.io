<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>A pool game with my own physic engine</title>
    <meta name="description" content="A personal blog where I write about my side projects">
    <meta name="keywords" content="statox blog">
    <meta property="og:title" content="The stuff I do">
    <meta property="og:url" content="https://www.statox.fr">
    <meta property="og:description" content="A personal blog where I write about my side projects">
    <meta property="og:type" content="website">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-fonts@1.1.1/fonts/inter.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css">

    
    <link rel="stylesheet" href="https://unpkg.com/prismjs@1.20.0/themes/prism-tomorrow.css">

    
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/material.css">
    <link rel="stylesheet" href="/css/minesweeper.css">
    <link rel="stylesheet" href="/css/boids.css">
    <link rel="stylesheet" href="/css/comments.css">

</head>
<body>
    <header>
        <h1>The stuff I do</h1>
        <nav>
            <a href="/">Home</a> /
            <a href="/notes/">Notes</a> /
            <a href="/about/">About</a> /
            <a href="/social/">Social</a> /
            <a href="/feed.xml">RSS</a>
        </nav>
    </header>

    <div class="content-container">
        
<h2>A pool game with my own physic engine</h2>
<p class="post-subheader">January 10, 2019 - 646 words</p>
<p><a href="/">← Posts</a></p>

<p>Go grab a beer and play the pool <a href="https://statox.github.io/p5-pool/" target="_blank" rel="noopener noreferrer">in the demo</a>!</p>
<p>And if that's your thing you can see the code <a href="https://github.com/statox/p5-pool" target="_blank" rel="noopener noreferrer">on Github</a>.</p>
<h3>Pool, snooker, billiard?</h3>
<p>I love to watch Daniel Shiffman's videos on Youtube, I can spend <em>hours</em> binging his channel <a href="https://www.youtube.com/channel/UCvjgXvBlbQiydffZU7m1_aw" target="_blank" rel="noopener noreferrer">The Coding Train</a> and it always gives me some inspiration for new projects.</p>
<p>This project was specifically inspired by his playlist <a href="https://www.youtube.com/playlist?list=PLRqwX-V7Uu6aFlwukCmDf0-1-uSR7mklK" target="_blank" rel="noopener noreferrer">The Nature of Code</a> where he shows how it is possible to simulate physical models with pretty simple javascript and a bit of math.</p>
<p>After watching some of the videos I decided that I was ready to try to do something on my own, and it was going to be a pool game! (Or a snooker, or a billiard, or whatever it is called... Basically a cue game).</p>
<h3>A simple simulation</h3>
<p>What do I need to do that?</p>
<p>First of all I need a table and some balls rolling on it. This is pretty straightforward: a p5.js canvas will be my table, my balls are simple javascript objects with some coordinates, the ability to apply a force on it (i.e. incrementing the coordinates), a friction force to keep the ball from rolling forever and some tests to prevent the balls from falling out of the table.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Ball</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> id<span class="token punctuation">,</span> color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>pos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">p5<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>vel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">p5<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>r <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">move</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Add friction</span><br>        <span class="token keyword">var</span> coefficientOfFriction <span class="token operator">=</span> <span class="token number">0.99</span><span class="token punctuation">;</span><br>        <span class="token keyword">this</span><span class="token punctuation">.</span>vel<span class="token punctuation">.</span><span class="token function">mult</span><span class="token punctuation">(</span>coefficientOfFriction<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Move the ball</span><br>        <span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vel<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>        <span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vel<span class="token punctuation">.</span>y<span class="token punctuation">;</span><br><br>        <span class="token comment">// Check the limits</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>r <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>r <span class="token operator">></span> <span class="token constant">W</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">this</span><span class="token punctuation">.</span>vel<span class="token punctuation">.</span>x <span class="token operator">*=</span> <span class="token operator">-</span> coefficientOfFriction<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>r <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>r <span class="token operator">></span> <span class="token constant">L</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">this</span><span class="token punctuation">.</span>vel<span class="token punctuation">.</span>y <span class="token operator">*=</span> <span class="token operator">-</span> coefficientOfFriction<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Easy, right? With that I can apply a force to a ball (as it's velocity) and way for the force to shrink over time. As a bonus I used the boundaries check to simply reverse the velocity of the ball, this is a lazy simulation of a perfectly on elastic collision. In real life some energy would be dissipated with the rebound but here, it's good enough.</p>
<p>Let's add to that a simple function to know if a ball is colliding with another one. To do that we can simply check the distance between two balls is larger than the sum of the balls radius. I came up with something quick and dirty, but mostly dirty. Here I knew I wanted to tag all the balls part of a collision:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">isColliding</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">otherBall</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Get the distance between the center of the two balls</span><br>    <span class="token keyword">var</span> dx <span class="token operator">=</span> otherBall<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>x<span class="token punctuation">;</span><br>    <span class="token keyword">var</span> dy <span class="token operator">=</span> otherBall<span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pos<span class="token punctuation">.</span>y<span class="token punctuation">;</span><br>    <span class="token keyword">var</span> distance <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>dx <span class="token operator">*</span> dx <span class="token operator">+</span> dy <span class="token operator">*</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// The balls touch if their distance is less than the sum of their radiuses</span><br>    <span class="token keyword">var</span> minDist <span class="token operator">=</span> otherBall<span class="token punctuation">.</span>r <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>r<span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&lt;</span> minDist<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">this</span><span class="token punctuation">.</span>collided <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>        otherBall<span class="token punctuation">.</span>collided <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Having this code I was able to create my pool, put balls on it, apply a force on them and change their color when they hit each other. That is cool... But now what?</p>
<h3>A not so simple simulation</h3>
<p>Well now is the time for the balls to bounce on each other when they touch!</p>
<p>And this is where the project became pretty fun because I didn't want to use a full blown physics engine, so I did mine... Well I did a function which bounced two circles against each other. The code of this function is <a href="https://github.com/statox/p5-pool/blob/54c4a280b4d90eb130f1c907b04f75f132f7ec93/Ball.js#L44-L115" target="_blank" rel="noopener noreferrer">here on Github</a> (as well as the whole project). It uses some workarounds and still has some bugs (sometimes the balls teleport away from each others when they touch, sometimes they get crazy and go off the table) also it is not really elegant to read... But it works! (Kinda)</p>


<p><a href="/">← Posts</a></p>

<hr>
<comments>
    <h3>Comments</h3>
    <a class="add-comment-btn" href="https://github.com/statox/blog-comments/issues/4#new_comment_field"  target="_blank" rel="noopener noreferrer">
        <button>Comment on Github</button>
    </a>
    <br>
</comments>

<script type="text/javascript" src="/scripts/githubComments.js"></script>
<script type="text/javascript">
    setupCommentsInPage(4);
</script>

    </div>

    <script data-goatcounter="https://statoxblog.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    <script async defer src="https://api.newcss.net/latest.js"></script>
    <noscript><img src="https://api.newcss.net/noscript.gif" alt=""></noscript>
</body>
</html>
