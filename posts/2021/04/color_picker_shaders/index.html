<!doctype html><html lang="en"><title>A first exploration of shaders with p5js - The stuff I do</title><meta name="description" content="A personal blog where I write about my side projects"/><meta name="robots" content="index,follow"/><meta name="author" content="statox"/><link rel="canonical" href="https://www.statox.fr/posts/2021/04/color_picker_shaders/"/><meta property="og:title" content="A first exploration of shaders with p5js - The stuff I do"/><meta property="og:type" content="article"/><meta property="og:url" content="https://www.statox.fr/posts/2021/04/color_picker_shaders/"/><meta property="og:description" content="A personal blog where I write about my side projects"/><meta name="twitter:card" content="summary"/><meta name="twitter:url" content="https://www.statox.fr/posts/2021/04/color_picker_shaders/"/><meta name="twitter:title" content="A first exploration of shaders with p5js - The stuff I do"/><meta name="twitter:description" content="A personal blog where I write about my side projects"/><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>A first exploration of shaders with p5js</title><meta name="description" content="A personal blog where I write about my side projects"/><meta name="keywords" content="statox blog"/><meta property="og:title" content="The stuff I do"/><meta property="og:url" content="https://www.statox.fr"/><meta property="og:description" content="A personal blog where I write about my side projects"/><meta property="og:type" content="website"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-fonts@1.1.1/fonts/inter.min.css"/><style>/*!
 * new.css framework forked from https://github.com/xz/new.css
 */:root{--nc-font-sans:"Inter",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--nc-font-mono:Consolas,monaco,"Ubuntu Mono","Liberation Mono","Courier New",Courier,monospace;--nc-tx-1:#000000;--nc-tx-2:#1a1a1a;--nc-tx-3:#6d7169;--nc-bg-0:#cecece;--nc-bg-1:#ffffff;--nc-bg-2:#f6f8fa;--nc-bg-3:#e5e7eb;--nc-lk-1:#0070f3;--nc-lk-2:#0366d6;--nc-lk-tx:#ffffff;--nc-ac-1:#79ffe1;--nc-ac-tx:#0c4047;--nc-d-tx-1:#ffffff;--nc-d-tx-2:#eeeeee;--nc-d-tx-3:#8a8d87;--nc-d-bg-0:#13191c;--nc-d-bg-1:#000000;--nc-d-bg-2:#111111;--nc-d-bg-3:#222222;--nc-d-lk-1:#3291ff;--nc-d-lk-2:#0070f3;--nc-d-lk-tx:#ffffff;--nc-d-ac-1:#7928ca;--nc-d-ac-tx:#ffffff}@media (prefers-color-scheme:dark){:root{--nc-tx-1:var(--nc-d-tx-1);--nc-tx-2:var(--nc-d-tx-2);--nc-bg-0:var(--nc-d-bg-0);--nc-bg-1:var(--nc-d-bg-1);--nc-bg-2:var(--nc-d-bg-2);--nc-bg-3:var(--nc-d-bg-3);--nc-lk-1:var(--nc-d-lk-1);--nc-lk-2:var(--nc-d-lk-2);--nc-lk-tx:var(--nc-d-lk-tx);--nc-ac-1:var(--nc-d-ac-1);--nc-ac-tx:var(--nc-d-ac-tx)}}*{margin:0;padding:0}address,area,article,aside,audio,blockquote,datalist,details,dl,fieldset,figure,form,iframe,img,input,meter,nav,ol,optgroup,option,output,p,pre,progress,ruby,section,table,textarea,ul,video{margin-bottom:1rem}button,html,input,select{font-family:var(--nc-font-sans)}body{margin:0 auto;max-width:750px;padding:2rem;border-radius:6px;overflow-x:hidden;word-break:break-word;overflow-wrap:break-word;background:var(--nc-bg-1);color:var(--nc-tx-2);font-size:1.03rem;line-height:1.5}::selection{background:var(--nc-ac-1);color:var(--nc-ac-tx)}h1,h2,h3,h4,h5,h6{line-height:1;color:var(--nc-tx-1);padding-top:.875rem}h1,h2,h3{color:var(--nc-tx-1);padding-bottom:2px;margin-bottom:8px;border-bottom:1px solid var(--nc-bg-2)}h4,h5,h6{margin-bottom:.3rem}h1{font-size:2.25rem}h2{font-size:1.85rem}h3{font-size:1.55rem}h4{font-size:1.25rem}h5{font-size:1rem}h6{font-size:.875rem}a{color:var(--nc-lk-1)}a:hover{color:var(--nc-lk-2)}abbr:hover{cursor:help}blockquote{padding:1.5rem;background:var(--nc-bg-2);border-left:5px solid var(--nc-bg-3)}abbr{cursor:help}blockquote :last-child{padding-bottom:0;margin-bottom:0}header{background:var(--nc-bg-2);border-bottom:1px solid var(--nc-bg-3);padding:2rem 1.5rem;margin:-2rem calc(0px - (50vw - 50%)) 2rem;padding-left:calc(50vw - 50%);padding-right:calc(50vw - 50%)}header h1,header h2,header h3{padding-bottom:0;border-bottom:0}header>:first-child{margin-top:0;padding-top:0}header>:last-child{margin-bottom:0}a button,button,input[type=button],input[type=reset],input[type=submit]{font-size:1rem;display:inline-block;padding:6px 12px;text-align:center;text-decoration:none;white-space:nowrap;background:var(--nc-lk-1);color:var(--nc-lk-tx);border:0;border-radius:4px;box-sizing:border-box;cursor:pointer;color:var(--nc-lk-tx)}a button[disabled],button[disabled],input[type=button][disabled],input[type=reset][disabled],input[type=submit][disabled]{cursor:default;opacity:.5;cursor:not-allowed}.button:enabled:hover,.button:focus,button:enabled:hover,button:focus,input[type=button]:enabled:hover,input[type=button]:focus,input[type=reset]:enabled:hover,input[type=reset]:focus,input[type=submit]:enabled:hover,input[type=submit]:focus{background:var(--nc-lk-2)}code,kbd,pre,samp{font-family:var(--nc-font-mono)}code,kbd,pre,samp{background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px;padding:3px 6px;font-size:.9em}kbd{border-bottom:3px solid var(--nc-bg-3)}pre{padding:1rem 1.4rem;max-width:100%;overflow:auto}pre code{background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}code pre{display:inline;background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}details{padding:.6rem 1rem;background:var(--nc-bg-2);border:1px solid var(--nc-bg-3);border-radius:4px}summary{cursor:pointer;font-weight:700}details[open]{padding-bottom:.75rem}details[open] summary{margin-bottom:6px}details[open]>:last-child{margin-bottom:0}dt{font-weight:700}dd::before{content:"‚Üí "}hr{border:0;border-bottom:1px solid var(--nc-bg-3);margin:1rem auto}fieldset{margin-top:1rem;padding:2rem;border:1px solid var(--nc-bg-3);border-radius:4px}legend{padding:auto .5rem}table{border-collapse:collapse;width:100%}td,th{text-align:left;padding:.5rem}th{font-weight:400;border-bottom:1px solid var(--nc-tx-1)}table caption{font-weight:700;margin-bottom:.5rem}textarea{max-width:100%}ol,ul{padding-left:2rem}li{margin-top:.4rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}mark{padding:3px 6px;background:var(--nc-ac-1);color:var(--nc-ac-tx)}input,select,textarea{padding:6px 12px;margin-bottom:.5rem;background:var(--nc-bg-2);color:var(--nc-tx-2);border:1px solid var(--nc-bg-3);border-radius:4px;box-shadow:none;box-sizing:border-box}img{max-width:100%}/*!
 * prism.js tomorrow night eighties for javascript, coffeescript, css and html
 * based on https://github.com/chriskempson/tomorrow-theme
 * Author: Rose Pritchard
 */code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.post-subheader{font-style:italic;color:var(--nc-tx-3)}.post-date{font-family:var(--nc-font-mono)}@media screen and (max-width:600px){.post-date{display:none}}.formatted-tag{font-family:var(--nc-font-mono);opacity:.6}.not-found{text-align:center}#not-found-canvas{z-index:-1}a{text-decoration:none}pre{max-height:50rem}img{display:block;margin-left:auto;margin-right:auto}ul.post-list{list-style-type:none}ul{list-style-type:circle}.header-anchor{font-size:small}/*!
 * Inspired by material theme https://www.material-theme.com/docs/reference/color-palette/
 */:root{--nc-tx-1:#546e7a;--nc-tx-2:#161d21;--nc-tx-3:#6d7169;--nc-bg-1:#f4f4f4;--nc-bg-2:#eae8e8;--nc-bg-3:#fafafa;--nc-lk-1:#176166;--nc-lk-2:#528aff;--nc-lk-tx:#f3f4f5;--nc-ac-1:#91b859;--nc-ac-tx:#fafafa;--nc-d-tx-1:#ffffff;--nc-d-tx-2:#b7b7b7;--nc-d-tx-3:#8a8d87;--nc-d-bg-1:#1e272c;--nc-d-bg-2:#161d21;--nc-d-bg-3:#263238;--nc-d-lk-1:#5e92ff;--nc-d-lk-2:#528aff;--nc-d-lk-tx:#2e3c43;--nc-d-ac-1:#c3e88d;--nc-d-ac-tx:#263238}@media (prefers-color-scheme:dark){:root{--nc-tx-1:var(--nc-d-tx-1);--nc-tx-2:var(--nc-d-tx-2);--nc-tx-3:var(--nc-d-tx-3);--nc-bg-1:var(--nc-d-bg-1);--nc-bg-2:var(--nc-d-bg-2);--nc-bg-3:var(--nc-d-bg-3);--nc-lk-1:var(--nc-d-lk-1);--nc-lk-2:var(--nc-d-lk-2);--nc-lk-tx:var(--nc-d-lk-tx);--nc-ac-1:var(--nc-d-ac-1);--nc-ac-tx:var(--nc-d-ac-tx)}}.nav-link{text-decoration:none}.nav-link.active{color:var(--nc-lk-2)}.hamburger{width:20px;height:2px;box-shadow:inset 0 0 0 32px,0 -6px,0 6px;margin:16px 7px;display:block}.topnav .icon{display:none}@media screen and (max-width:600px){.topnav span.nav-item:not(.active){display:none}.topnav span.icon{float:right;display:block;right:0;top:0;color:var(--nc-lk-1)}}@media screen and (max-width:600px){.topnav .nav-separator{display:none}}@media screen and (max-width:600px){.topnav.responsive{position:relative}.topnav.responsive span.icon{position:absolute;right:0;top:0;color:var(--nc-lk-2)}.topnav.responsive span{float:none;display:block;text-align:left}.topnav.responsive span.nav-item:not(.active){display:block}}.comment{--comment-bg:#e3efee;--comment-d-bg:#2a4765;margin-top:20px;padding:5px}.add-comment-btn{float:right}.comment-header{background:var(--comment-bg);padding-right:100px;padding-left:10px;border-top-left-radius:10px;border-top-right-radius:10px;padding:5px}.comment-content{border:2px solid var(--comment-bg);border-bottom-left-radius:10px;border-bottom-right-radius:10px}.comment-text{padding:10px}.comment-reactions{border-top:2px solid var(--comment-bg);padding:5px}.comment-reaction-item{padding-right:10px;padding-left:10px;border-right:2px solid var(--comment-bg)}@media (prefers-color-scheme:dark){.comment{--comment-bg:var(--comment-d-bg)}}kbd{--black-800:#242729;--white:#fff;--black-075:#e4e6e8;--black-300:#9fa6ad;--s-prose-line-height:1.5;--ff-sans:Arial,"Helvetica Neue",Helvetica,sans-serif}@media (prefers-color-scheme:dark){kbd{--black-800:#e7e8eb;--white:#2d2d2d;--black-075:#404345;--black-300:#7d848d}}kbd{display:inline-block;margin:0 .1em;padding:.1em .6em;font-family:var(--nc-font-sans);font-size:11px;line-height:var(--s-prose-line-height);color:var(--black-800);text-shadow:0 1px 0 var(--white);background-color:var(--black-075);border:1px solid var(--black-300);border-radius:3px;box-shadow:0 1px 1px rgba(12,13,14,.15),inset 0 1px 0 0 #fff;overflow-wrap:break-word}.color-line{display:flex;flex:0 auto;flex-flow:row;justify-content:space-around}.color-block{color:#000;width:300px;height:50px;text-align:center;text-decoration:none;font-weight:700;border:grey}.text-white{color:#fff}.text-black{color:#000}</style><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5"/><script>function navbarToggle(){var a=document.getElementById("header-navbar");"topnav"===a.className?a.className+=" responsive":a.className="topnav"}</script></head><body><header><h1>The stuff I do</h1><nav class="topnav" id="header-navbar" onclick="navbarToggle()"><span class="nav-item active"><a class="nav-link active" href="/">Home</a> <i class="nav-separator">‚ô¢ </i></span><span class="nav-item"><a class="nav-link" href="/projects/">Projects</a> <i class="nav-separator">‚ô¢ </i></span><span class="nav-item"><a class="nav-link" href="/coolcovers/">Cool covers</a> <i class="nav-separator">‚ô¢ </i></span><span class="nav-item"><a class="nav-link" href="/notes/">Notes</a> <i class="nav-separator">‚ô¢ </i></span><span class="nav-item"><a class="nav-link" href="/about/">About</a> <i class="nav-separator">‚ô¢ </i></span><span class="nav-item"><a class="nav-link" href="/ring/">Ring</a> <i class="nav-separator">‚ô¢ </i></span><span class="nav-item"><a class="nav-link" href="/feed.xml">RSS</a> <i class="nav-separator"></i> </span><span class="icon hamburger" onclick="navbarToggle()"></span></nav></header><div class="content-container"><h2>A first exploration of shaders with p5js</h2><p class="post-subheader"><span id="post_date"></span> - 3393 words - <span id="commentCounter"></span> <span id="comment_word"></span></p><p><a href="/">‚Üê Posts</a></p><p>For many years now I had the idea to play with shaders in the back of my mind but I had never dared looking into it because that seemed like a very complex topic which I didn't have time to dig into. A few days ago I finally started my first project using shaders and I want to share this experiment, both for documenting purpose so that I can build on top of that in future projects but also to show that it can be fairly easy to some satisfying results.</p><p>If you have some basic understanding of how <a href="https://p5js.org/" target="_blank" rel="noopener noreferrer">p5js</a> works your shouldn't have trouble following this article. If you never used p5js, you should now it is a nice Javascript library for creative coding which allows you to draw in a HTML canvas, and you also should be able to follow what's coming next.</p><p>As this is my first time playing with shaders there are clearly a lot of things I don't know yet and I may have made some obvious mistakes (if you spot them please point them out to me). My goal here is not to show how to create the best possible graphic project but to give you a taste of how it is possible to use shaders in your browser and how to get started. At the end of the article I list a bunch of resources which should be useful to anyone curious to use shaders in their projects.</p><p>The source code of the project is <a href="https://github.com/statox/color-picker" target="_blank" rel="noopener noreferrer">on Github</a> and a demo is hosted on <a href="https://statox.github.io/color-picker/" target="_blank" rel="noopener noreferrer">this Github page</a>.</p><p>My goal was to create a color picker as one could find if they <a href="https://duckduckgo.com/?t=canonical&amp;q=color+picker" target="_blank" rel="noopener noreferrer">duck &quot;color picker&quot;</a> because this is a simple graphical application which doesn't require complex math or 3D understanding. So that's what we will be building today.</p><p>Before we begin here is a very quick reminder of what a shader is:</p><blockquote><p>A shader is a small program that runs entirely on your graphics card (GPU) rather than on your processing unit (CPU). It is executed in parallel for all the pixels which should be rendered making it very fast to draw on the screen. The shader is responsible for deciding which color each pixel should be.</p></blockquote><h3 id="a-first-color-picker-without-shader">A first color picker without shader <a class="header-anchor" href="#a-first-color-picker-without-shader">üîó</a></h3><p>To start working with shaders I wanted to keep things as simple as possible and I believe using <a href="https://p5js.org/" target="_blank" rel="noopener noreferrer">p5js</a> is a great way to achieve that. I was already familiar with this framework and it makes it very easy to get going with a project. The cool thing with p5js is that we can start implementing our code in Javascript and then drop in the replacement for the particular areas we want to use a shader on.</p><p>So I first created a simple fully javascript version on codepen. This was the opportunity for me to learn how <a href="https://en.wikipedia.org/wiki/HSL_and_HSV" target="_blank" rel="noopener noreferrer">the HSB color system</a> works:</p><p class="codepen" data-height="265" data-theme-id="dark" data-default-tab="js,result" data-user="statox" data-slug-hash="poRKpEb" style="height:265px;box-sizing:border-box;display:flex;align-items:center;justify-content:center;border:2px solid;margin:1em 0;padding:1em" data-pen-title="Color picker"><span>See the Pen <a href="https://codepen.io/statox/pen/poRKpEb">Color picker</a> by Adrien Fabre (<a href="https://codepen.io/statox">@statox</a>) on <a href="https://codepen.io">CodePen</a>.</span></p><script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script><p>This first version isn't that bad but is it extremely slow! The <code>draw()</code> function (which is the main loop executed for each frame) has a nested <code>for</code> loop iterating on each pixels of the area showing the color gradient to define which color should have the pixels. This gets pretty expensive when this area becomes bigger. That's when using a shader will become interesting: That will allow us to write a program which will be executed for each pixels in parallel on the GPU and will draw the pixels with the right color. I expect this to result in a much more fluid interface, with no latency between moving the mouse and see the new color on screen.</p><p><em>Note that one could have used the <a href="https://p5js.org/reference/#/p5/pixels" target="_blank" rel="noopener noreferrer"><code>pixels</code></a> feature of p5js to manipulate the pixels directly rather than creating points as I'm doing in my first version. That would be more efficient and might give a satisfying result for a simple color picker, but still it's not as fun a discovering shaders.</em></p><p>This first version allowed me to define the 3 main areas that I want to render with a shader:</p><ul><li>The rainbow: This is the line on the top which allows the user to change the hue of the current color;</li><li>The picker: The rectangle on the left with a gradient on the current hue, the user will be able to choose a specific saturation and brightness by clicking there;</li><li>The sample: The rectangle on the right which shows the currently selected color.</li></ul><p><img src="../../../../images/color_picker_shader/picker_zones.png" alt="Picker zones"/></p><h3 id="a-quick-word-about-hsb">A quick word about HSB <a class="header-anchor" href="#a-quick-word-about-hsb">üîó</a></h3><p>Before starting to dig into the code it's better to understand the color system we'll be using in this article: The HSB color system!</p><p>There is nothing too complex about it, and <a href="https://learnui.design/blog/the-hsb-color-system-practicioners-primer.html" target="_blank" rel="noopener noreferrer">this website</a> does a great job at explaining in details how it works. Here are a few points to keep in mind:</p><ul><li><p><strong>HSB</strong> stands for <strong>H</strong>ue, <strong>S</strong>aturation and <strong>B</strong>rightness.</p></li><li><p>The hue value represent the raw color. It is expressed as an angle as shown on the color wheel here. This angle is between <code>0</code>-<code>360</code> degrees, but in a p5 sketch we map these values to the range <code>0</code>-<code>100</code>, and in a shader we will map it in the range <code>0.0</code>-<code>1.0</code>. But no matter which range we use the relative difference between the color is always the same.<br/><img src="../../../../images/color_picker_shader/color_wheel.png" alt="color wheel"/></p><center><i>Color wheel borrowed from <a href="https://learnui.design/blog/the-hsb-color-system-practicioners-primer.html">this site</a></i></center></li><li><p>The saturation is how rich the color is: A 100% saturation is very colorful while a 0% saturation is grey. With a 0% saturation no matter which hue you use you will always get the same grey</p><p class="color-line"><span class="color-block text-black" style="background-color:#7f7f7f">0%</span> <span class="color-block text-black" style="background-color:#9f5f5f">25%</span> <span class="color-block text-black" style="background-color:#bf3f3f">50%</span> <span class="color-block text-white" style="background-color:#df1f1f">75%</span> <span class="color-block text-white" style="background-color:red">100%</span></p><p class="color-line"><span class="color-block text-black" style="background-color:#7f7f7f">0%</span> <span class="color-block text-black" style="background-color:#5f6a9f">25%</span> <span class="color-block text-black" style="background-color:#3f55bf">50%</span> <span class="color-block text-white" style="background-color:#1f3fdf">75%</span> <span class="color-block text-white" style="background-color:#002aff">100%</span></p></li><li><p>The brightness is how... bright is your color? Simply put: 0% brightness is complete black no matter the hue, 100% is white if saturation is 0% or just a very bright color.</p><p class="color-line"><span class="color-block text-white" style="background-color:#000">0%</span> <span class="color-block text-white" style="background-color:#7f0000">25%</span> <span class="color-block text-white" style="background-color:red">50%</span> <span class="color-block text-black" style="background-color:#ff7f7f">75%</span> <span class="color-block text-black" style="background-color:#fff">100%</span></p><p class="color-line"><span class="color-block text-white" style="background-color:#000">0%</span> <span class="color-block text-white" style="background-color:#00157f">25%</span> <span class="color-block text-white" style="background-color:#002aff">50%</span> <span class="color-block text-black" style="background-color:#7f94ff">75%</span> <span class="color-block text-black" style="background-color:#fff">100%</span></p></li></ul><p>Note that you'll also find online some references to the color systems <strong>HSV</strong> and <strong>HSL</strong>. If I believe the wikipedia page <strong>HSV</strong> is the exact same thing as <strong>HSB</strong> excepted <strong>B</strong>rightness is named <strong>V</strong>alue. And <strong>HSL</strong> is <strong>H</strong>ue, <strong>S</strong>aturation, <strong>L</strong>ightness which is kind of the inverse of Brightness (if you want details, check wiki they explain it better than I'll do).</p><h3 id="our-first-shader">Our first shader <a class="header-anchor" href="#our-first-shader">üîó</a></h3><p>Now that we know what our project should look like and we understand our color system let's get started with shaders! The first step is to use a very basic shader in a p5js project. Fortunately the doc gives <a href="https://p5js.org/examples/3d-basic-shader.html" target="_blank" rel="noopener noreferrer">a good example</a> of a very simple usage:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// this variable will hold our shader object</span><br><span class="token keyword">let</span> theShader<span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">preload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>    <span class="token comment">// load the shader</span><br>    theShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span><span class="token string">'assets/basic.vert'</span><span class="token punctuation">,</span> <span class="token string">'assets/basic.frag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// shaders require WEBGL mode to work</span><br>    <span class="token function">createCanvas</span><span class="token punctuation">(</span><span class="token number">710</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token constant">WEBGL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">noStroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// shader() sets the active shader with our shader</span><br>    <span class="token function">shader</span><span class="token punctuation">(</span>theShader<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// rect gives us some geometry on the screen</span><br>    <span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>This will use a shader named <code>basic</code> to draw a rectangle on screen. The interesting part is then to implement this shader. As we can see in the <code>loadShader()</code> call we need 2 files to define a shader:</p><ul><li><code>shader.vert</code></li><li><code>shader.frag</code></li></ul><p>These files are written with <a href="https://en.wikipedia.org/wiki/OpenGL_Shading_Language" target="_blank" rel="noopener noreferrer">GLSL</a> which is a widely used language to program shaders, this is the language we will use the shader files in the articles.</p><p>My basic understanding is that the <code>vert</code> file is used to calculate the screen position of the different vertexes (i.e. points forming the shape) we want to draw. This comes in pretty useful when one needs to draw a 3D shape, but that also considerably increases the complexity of the shader. For now we will focus only on 2D drawings, so our <code>vert</code> file will be pretty simple and it will be the same in all of the shaders we will talk about in the rest of this article. It looks like this:</p><pre class="language-glsl"><code class="language-glsl"><span class="token comment">/*<br> * vert file and comments from adam ferriss<br> * https://github.com/aferriss/p5jsShaderExamples<br> * with additional comments from Louise Lessel<br> */</span><br><br><span class="token comment">// We'll not pay attention to that in this article. This change the precision</span><br><span class="token comment">// on the numbers we use.</span><br><span class="token keyword">precision</span> <span class="token keyword">highp</span> <span class="token keyword">float</span><span class="token punctuation">;</span><br><br><span class="token comment">// This ‚Äúvec3 aPosition‚Äù is a built in shader functionality.</span><br><span class="token comment">// You must keep that naming.</span><br><span class="token comment">// It's automatically used by p5 to set the position of every vertex on your canvas</span><br><span class="token keyword">attribute</span> <span class="token keyword">vec3</span> aPosition<span class="token punctuation">;</span><br><br><span class="token comment">// We always must do at least one thing in the vertex shader:</span><br><span class="token comment">// tell the pixel where on the screen it lives:</span><br><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// copy the position data into a vec4, using 1.0 as the w component</span><br>  <span class="token keyword">vec4</span> positionVec4 <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>aPosition<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Make sure the shader covers the entire screen:</span><br>  <span class="token comment">// scale the rect by two, and move it to the center of the screen</span><br>  <span class="token comment">// if we don't do this, it will appear with its bottom left corner</span><br>  <span class="token comment">// in the center of the sketch</span><br>  positionVec4<span class="token punctuation">.</span>xy <span class="token operator">=</span> positionVec4<span class="token punctuation">.</span>xy <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Send the vertex information on to the fragment shader</span><br>  <span class="token comment">// this is done automatically, as long as you put it into the built in</span><br>  <span class="token comment">// shader variable ‚Äúgl_Position‚Äù</span><br>  gl_Position <span class="token operator">=</span> positionVec4<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>As you can see from the comments I didn't write this code: I <s>stole</s> borrowed it from <a href="https://github.com/aferriss/p5jsShaderExamples" target="_blank" rel="noopener noreferrer">this amazing github</a>. I won't go too much into details because really all this file does is take the position of a pixel <code>aPostion</code> translate its <code>x</code> and <code>y</code> components to the top left corner ‚Äîthis is necessary given how p5js and shaders work together‚Äî and send this position via the <code>gl_Position</code> to the <code>frag</code> file.</p><p>All the fun will happen in the <code>frag</code> file which is responsible for drawing the pixel with the right color at the position it is given. Let's begin with a very unexciting <code>frag</code> which draws all the pixels in red:</p><pre class="language-glsl"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">highp</span> <span class="token keyword">float</span><span class="token punctuation">;</span><br><br><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// gl_FragColor is a built in shader variable,</span><br>    <span class="token comment">// and your .frag file must set it</span><br>    <span class="token comment">// We are setting the color into a new vec4, with a transparency of 1 (no transparency)</span><br>    gl_FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>In a <code>frag</code> file you must set the <code>gl_FragColor</code> variable: This will tell the shader which color to use for the current pixel and that will stop the execution of the <code>main()</code> function. The <code>gl_FragColor</code> takes four components <code>R</code> (red), <code>G</code> (green), <code>B</code> (blue), <code>A</code> (alpha), which is a common way to describe a color with the <a href="https://en.wikipedia.org/wiki/RGBA_color_model" target="_blank" rel="noopener noreferrer">RGBA color system</a>. Note that usually the <code>RGB</code> components range between <code>0</code> and <code>255</code> but in a shader all values range between <code>0.0</code> and <code>1.0</code>, that's why red is <code>1.0, 0.0, 0.0</code> (and blue would be <code>0.0, 0.0, 1.0</code>)</p><p><img src="../../../../images/color_picker_shader/red_rectangle.png" alt="Red rectangle"/></p><p>The result is a simple red rectangle but it is drawn by the GPU, we are heading the right way! We will be able to reuse this shader in the &quot;sample&quot; section of the color picker by passing the components of the color to the shader. We will see how to pass values to the shader in the next part.</p><h3 id="rainbows-%F0%9F%8C%88">Rainbows üåà <a class="header-anchor" href="#rainbows-%F0%9F%8C%88">üîó</a></h3><p>Our red rectangle quickly becomes boring so let's work on our rainbow area which will allow to choose the hue of the color in the sample. To do so we will keep the same <code>vert</code> file but we will change the <code>frag</code> file a bit:</p><pre class="language-glsl"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">highp</span> <span class="token keyword">float</span><span class="token punctuation">;</span><br><br><span class="token comment">// This is a uniform value passed by p5 which will allow us to</span><br><span class="token comment">// scale the drawing properly</span><br><span class="token comment">// It contains the full size of the drawn area in a 2D vector</span><br><span class="token keyword">uniform</span> <span class="token keyword">vec2</span> u_resolution<span class="token punctuation">;</span><br><br><span class="token comment">// In the p5 sketch we work with HSB colors because they are easier to use when</span><br><span class="token comment">// creating a gradient, but shaders only take RGB colors</span><br><span class="token comment">// This function takes a 3D vector [H, S, B] and returns a 3D vector [R, G, B]</span><br><span class="token comment">// https://gist.github.com/yiwenl/745bfea7f04c456e0101</span><br><span class="token keyword">vec3</span> <span class="token function">hsb2rgb</span><span class="token punctuation">(</span><span class="token keyword">vec3</span> c<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">vec4</span> K <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">vec3</span> p <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">fract</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>xxx <span class="token operator">+</span> K<span class="token punctuation">.</span>xyz<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6.0</span> <span class="token operator">-</span> K<span class="token punctuation">.</span>www<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> c<span class="token punctuation">.</span>z <span class="token operator">*</span> <span class="token function">mix</span><span class="token punctuation">(</span>K<span class="token punctuation">.</span>xxx<span class="token punctuation">,</span> <span class="token function">clamp</span><span class="token punctuation">(</span>p <span class="token operator">-</span> K<span class="token punctuation">.</span>xxx<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Normalize the position (to be in range 0.0 - 1.0)</span><br>    <span class="token comment">// The .xy notation applies the same operation on both x and y components</span><br>    <span class="token keyword">vec2</span> st <span class="token operator">=</span> gl_FragCoord<span class="token punctuation">.</span>xy<span class="token operator">/</span>u_resolution<span class="token punctuation">.</span>xy<span class="token punctuation">;</span> <br><br>    <span class="token comment">// Use the x position of the pixel to define its hue</span><br>    <span class="token comment">// (with saturation and brightness to 1)</span><br>    <span class="token comment">// Then convert the HSB color to RGB</span><br>    <span class="token keyword">vec3</span> color <span class="token operator">=</span> <span class="token function">hsb2rgb</span><span class="token punctuation">(</span><span class="token keyword">vec3</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Color the pixel</span><br>    gl_FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Here the code gets a bit more interesting. First we pass a uniform <code>u_resolution</code>, this is a variable which will have the same value for all the pixels. This uniform holds the size of the shape drawn in the page and it is sent to the shader with the p5js function <a href="https://p5js.org/reference/#/p5.Shader/setUniform" target="_blank" rel="noopener noreferrer"><code>setUniform()</code></a>. It is used in the <code>main()</code> function to normalize the <code>gl_FragCoord</code> variable and store this normalized position in <code>st</code> (which is a standard name to do this).</p><p>We can then use the <code>x</code> component of the normalized position to define the color of the pixels. I reused a helper function I found <a href="https://gist.github.com/yiwenl/745bfea7f04c456e0101" target="_blank" rel="noopener noreferrer">on Github</a> to convert HSB to RGB.</p><p>Now all we need is to add the uniform to our <code>draw()</code> function:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// shader() sets the active shader with our shader</span><br>    <span class="token function">shader</span><span class="token punctuation">(</span>theShader<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Set the resolution as a uniform</span><br>    theShader<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">'u_resolution'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>p5<span class="token punctuation">.</span>width<span class="token punctuation">,</span> p5<span class="token punctuation">.</span>height<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// rect gives us some geometry on the screen</span><br>    <span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Aaand: üåà RAINBOW üåà</p><p><img src="../../../../images/color_picker_shader/rainbow.png" alt="Rainbow rectangle"/></p><h3 id="the-picker">The picker <a class="header-anchor" href="#the-picker">üîó</a></h3><p>We now know how to create a plain color rectangle and a rainbow rectangle, the last thing we need to draw with a shader is our &quot;picker&quot; rectangle. This area will show a gradient of color: We will use the same hue for the whole space but we will change the brightness along the y axis and the saturation along the x axis. Again the <code>vert</code> file doesn't change and the <code>frag</code> file will be very similar to the one for the rainbow shader:</p><pre class="language-glsl"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">highp</span> <span class="token keyword">float</span><span class="token punctuation">;</span><br><br><span class="token comment">// Resolution to scale the drawing</span><br><span class="token keyword">uniform</span> <span class="token keyword">vec2</span> u_resolution<span class="token punctuation">;</span><br><span class="token comment">// The hue currently selected by the user</span><br><span class="token keyword">uniform</span> <span class="token keyword">float</span> u_hue<span class="token punctuation">;</span><br><br><span class="token comment">// https://gist.github.com/yiwenl/745bfea7f04c456e0101</span><br><span class="token keyword">vec3</span> <span class="token function">hsb2rgb</span><span class="token punctuation">(</span><span class="token keyword">vec3</span> c<span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">vec4</span> K <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">vec3</span> p <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">fract</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>xxx <span class="token operator">+</span> K<span class="token punctuation">.</span>xyz<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6.0</span> <span class="token operator">-</span> K<span class="token punctuation">.</span>www<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> c<span class="token punctuation">.</span>z <span class="token operator">*</span> <span class="token function">mix</span><span class="token punctuation">(</span>K<span class="token punctuation">.</span>xxx<span class="token punctuation">,</span> <span class="token function">clamp</span><span class="token punctuation">(</span>p <span class="token operator">-</span> K<span class="token punctuation">.</span>xxx<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Normalize the position between 0 and 1</span><br>    <span class="token keyword">vec2</span> st <span class="token operator">=</span> gl_FragCoord<span class="token punctuation">.</span>xy<span class="token operator">/</span>u_resolution<span class="token punctuation">.</span>xy<span class="token punctuation">;</span> <br><br>    <span class="token comment">// Set the pixel color using the current hue</span><br>    <span class="token comment">// and the position to make a gradient</span><br>    <span class="token keyword">vec3</span> color <span class="token operator">=</span> <span class="token function">hsb2rgb</span><span class="token punctuation">(</span><span class="token keyword">vec3</span><span class="token punctuation">(</span>u_hue<span class="token punctuation">,</span> st<span class="token punctuation">.</span>x<span class="token punctuation">,</span> st<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Color the pixel</span><br>    gl_FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>The principle is very similar to the rainbow shader, two things change:</p><ul><li>First we pass new uniform <code>u_hue</code> which determines the hue selected by the user. This hue is passed as a float ranging from <code>0.0</code> to <code>1.0</code> by the p5 sketch.</li><li>Then we use this hue as well as the normalized position to get the color of the pixel.</li></ul><p>In the <code>draw()</code> function we will use the following line to set the hue depending on the x component of the mouse position:</p><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// map mouseX from range 0-width to range 0-1</span><br>theShader<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">'u_hue'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">map</span><span class="token punctuation">(</span>mouseX<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>And here is our result!</p><p><img src="../../../../images/color_picker_shader/picker_rectangle.gif" alt="Picker rectangle"/></p><center><i>Don't be fooled by the potato ü•î quality of my screencap, the actual webpage doesn't have these ugly artifacts.</i></center><h3 id="making-a-complete-color-picker">Making a complete color picker <a class="header-anchor" href="#making-a-complete-color-picker">üîó</a></h3><p>Now comes the part where we put everything together to get a working color picker. We don't need to change the shader files anymore we will just edit the p5 sketch to get the user inputs and draw what we need accordingly.</p><p>The user will have two ways to interact with the picker:</p><ul><li>When they click on the rainbow and move the mouse on it we will update the hue used in the picker rectangle.</li><li>When they click the picker and move the mouse on it we will update the saturation and brightness.</li></ul><p>Each change in hue, saturation or brightness will be reflected in the sample rectangle showing the currently selected color.</p><p>First we will update the <code>preload()</code> function to load the 3 different shaders:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">preload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Uniform color used for the sample rectangle</span><br>    uniformShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span><span class="token string">'shader/uniform.vert'</span><span class="token punctuation">,</span> <span class="token string">'shader/uniform.frag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// Saturation and brightness gradient for the picker rectangle</span><br>    pickerShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span><span class="token string">'shader/picker.vert'</span><span class="token punctuation">,</span> <span class="token string">'shader/picker.frag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// Hue gradient for the rainbow rectangle</span><br>    rainbowShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span><span class="token string">'shader/rainbow.vert'</span><span class="token punctuation">,</span> <span class="token string">'shader/rainbow.frag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>So now that we have three different shaders in the sketch things will get a bit more complex than before. Given our previous draw function I was tempted to do something like this:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Draw the sample</span><br>    <span class="token function">shader</span><span class="token punctuation">(</span>uniformShader<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">rect</span><span class="token punctuation">(</span><span class="token comment">/* sample coordinates */</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Draw the picker</span><br>    <span class="token function">shader</span><span class="token punctuation">(</span>pickerShader<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">rect</span><span class="token punctuation">(</span><span class="token comment">/* picker coordinates */</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Draw the rainbow</span><br>    <span class="token function">shader</span><span class="token punctuation">(</span>rainbowShader<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">rect</span><span class="token punctuation">(</span><span class="token comment">/* rainbow coordinates */</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>But that doesn't work, instead we will need to use a buffer canvas in which we will draw with the shader offscreen. Then we will use this as a texture for the rectangles we will draw on the canvas onscreen.</p><p>That sounds a bit barbarian but in practice it's not that bad.</p><p>First we need to update <code>setup()</code> to create these buffers and give them the dimensions of our future rectangles to draw:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Create the actual canvas where we will draw our rectangles</span><br>        <span class="token function">createCanvas</span><span class="token punctuation">(</span><span class="token constant">PICKER_WIDTH</span> <span class="token operator">+</span> <span class="token constant">SAMPLE_WIDTH</span><span class="token punctuation">,</span> <span class="token constant">TOTAL_HEIGHT</span><span class="token punctuation">,</span> <span class="token constant">WEBGL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">// Setup colormode to use HSB (This only impacts p5js not the shaders)</span><br>        <span class="token function">colorMode</span><span class="token punctuation">(</span><span class="token constant">HSB</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        <span class="token comment">/*<br>         * initialize the createGraphics layers<br>         */</span><br>        <span class="token comment">// Create a buffer canvas</span><br>        uniformGraphics <span class="token operator">=</span> <span class="token function">createGraphics</span><span class="token punctuation">(</span><span class="token constant">SAMPLE_WIDTH</span><span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token constant">WEBGL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">// Set the shader to be used in this buffer</span><br>        uniformGraphics<span class="token punctuation">.</span><span class="token function">shader</span><span class="token punctuation">(</span>uniformShader<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        pickerGraphics <span class="token operator">=</span> <span class="token function">createGraphics</span><span class="token punctuation">(</span><span class="token constant">PICKER_WIDTH</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">,</span> <span class="token constant">WEBGL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        pickerGraphics<span class="token punctuation">.</span><span class="token function">shader</span><span class="token punctuation">(</span>pickerShader<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>        rainbowGraphics <span class="token operator">=</span> <span class="token function">createGraphics</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">,</span> <span class="token constant">WEBGL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        rainbowGraphics<span class="token punctuation">.</span><span class="token function">shader</span><span class="token punctuation">(</span>rainbowShader<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Now in <code>draw()</code> let's draw our sample rectangle:</p><pre class="language-javascript"><code class="language-javascript"><br><span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Some magic to get the hue, saturation and brightness in</span><br>    <span class="token comment">// the variables h, sPicker and bPicker</span><br>    <span class="token operator">...</span><br><br>    <span class="token comment">/*<br>     * Draw the sample rectangle<br>     */</span><br>    <span class="token comment">// Pass the current hue, saturation and brightness as an uniform to the shader</span><br>    uniformShader<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">'u_color'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>h <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">,</span> sPicker <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">,</span> bPicker <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// Draw a rectangle using the shader in the buffer canvas (offscreen)</span><br>    uniformGraphics<span class="token punctuation">.</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token constant">PICKER_WIDTH</span><span class="token punctuation">,</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">,</span> <span class="token constant">SAMPLE_WIDTH</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// Instruct p5 to use what was drawn offscreen in the buffer as a texture</span><br>    <span class="token function">texture</span><span class="token punctuation">(</span>uniformGraphics<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// Draw (onscreen) the rectangle, using the texture</span><br>    <span class="token function">rect</span><span class="token punctuation">(</span><span class="token constant">PICKER_WIDTH</span><span class="token punctuation">,</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">,</span> <span class="token constant">SAMPLE_WIDTH</span><span class="token punctuation">,</span> height <span class="token operator">-</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>With that we get the same result as our first example i.e. a simple plain rectangle. We can reuse the sample principle to draw our two other rectangles:</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Some magic to get the hue, saturation and brightness in</span><br>    <span class="token comment">// the variables h, sPicker and bPicker</span><br>    <span class="token operator">...</span><br><br>    <span class="token comment">// Draw the sample rectangle as before</span><br>    <span class="token operator">...</span><br><br>    <span class="token comment">// Draw the picker rectangle</span><br>    pickerShader<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">'u_resolution'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token constant">PICKER_WIDTH</span><span class="token punctuation">,</span> p5<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    pickerShader<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">'u_hue'</span><span class="token punctuation">,</span> h <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    pickerGraphics<span class="token punctuation">.</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">PICKER_WIDTH</span><span class="token punctuation">,</span> p5<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    p5<span class="token punctuation">.</span><span class="token function">texture</span><span class="token punctuation">(</span>pickerGraphics<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    p5<span class="token punctuation">.</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">,</span> <span class="token constant">PICKER_WIDTH</span><span class="token punctuation">,</span> p5<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Drawn the rainbow rectangle</span><br>    rainbowShader<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">'u_resolution'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>p5<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    rainbowGraphics<span class="token punctuation">.</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> p5<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    p5<span class="token punctuation">.</span><span class="token function">texture</span><span class="token punctuation">(</span>rainbowGraphics<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    p5<span class="token punctuation">.</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> p5<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token constant">BOX_TOP_HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>And here we are!</p><p><img src="../../../../images/color_picker_shader/picker_3_rectangles.png" alt="The three rectangles of the color picker"/></p><p>Now adding a bit of logic in our sketch to detect when the user clicks on the screen and convert the mouse position into the HSB values, doing some additional conversions to get the RGB and hex values corresponding to the current selection and putting all of that in a terribly bad looking UI and we have a complete color picker:</p><p><img src="../../../../images/color_picker_shader/color_picker_demo.gif" alt="Demo of the complete color picker"/></p><p>An online demo is available <a href="https://statox.github.io/color-picker/" target="_blank" rel="noopener noreferrer">here</a>, it doesn't work very well on my iPhone but it looks like it's ok on both Firefox and Chromium.</p><h3 id="a-new-world-of-opportunities">A new world of opportunities <a class="header-anchor" href="#a-new-world-of-opportunities">üîó</a></h3><p>This project was really fun to do and I hope that if you never played with shaders before it gave you some inspiration to do the same! I am really excited to use this new skill I learned because I've done <a href="https://www.statox.fr/posts/2020/11/ants/" target="_blank" rel="noopener noreferrer">a few</a> <a href="https://www.statox.fr/posts/2020/09/boids/" target="_blank" rel="noopener noreferrer">simulations</a> in the browser with p5 before but they were all limited by their performances. Offloading some of the work to the GPU should allow me to create simulations with much larger definitions. I'm thinking about trying to make a <a href="https://en.wikipedia.org/wiki/Critters_(cellular_automaton)" target="_blank" rel="noopener noreferrer">Critters cellular automaton</a>, exploring <a href="https://www.shadertoy.com/view/lsX3W4" target="_blank" rel="noopener noreferrer">fractal</a> or maybe maps generation as seen in some of <a href="https://www.youtube.com/channel/UCmtyQOKKmrMVaKuRXz02jbQ" target="_blank" rel="noopener noreferrer">Sebastian Lague's videos</a>.</p><p>If you also want to get started with shaders here is a list of some interesting resources:</p><ul><li><a href="https://itp-xstory.github.io/p5js-shaders" target="_blank" rel="noopener noreferrer">itp-xstory.github.io</a> - An amazing introduction to using shaders with p5js</li><li><a href="https://github.com/aferriss/p5jsShaderExamples" target="_blank" rel="noopener noreferrer">aferriss/p5jsShaderExamples</a> - Some useful examples of GLSL shaders for p5js</li><li><a href="https://p5js.org/reference/#/p5/shader" target="_blank" rel="noopener noreferrer">p5js.org</a> - The p5js doc about shaders</li><li><a href="https://lea.codes/webgl/" target="_blank" rel="noopener noreferrer">lea.codes</a> - The personal website of a dev who does cool things with shaders and threejs</li><li><a href="https://thebookofshaders.com/" target="_blank" rel="noopener noreferrer">The book of shaders</a> - The Bible of shader programming</li></ul><p>If you know of other good resources or want to discuss a project idea, leave a comment on this article!</p><p><a href="/">‚Üê Posts</a></p><hr/><p></p><h3>Related posts</h3><p>Posts in the same category: <span class="formatted-tag">[p5]</span></p><ul><li><span class="post-date">Jan 2021</span> <a class="post-link" href="/posts/2021/01/reversi/">Winter holidays unfinished projects (2/2) - Reversi</a></li><li><span class="post-date">Jan 2021</span> <a class="post-link" href="/posts/2021/01/triomino/">Winter holidays unfinished projects (1/2) - Triomino</a></li></ul><hr/><comments><h3>Comments</h3><a class="add-comment-btn" href="https://github.com/statox/blog-comments/issues/26#new_comment_field" target="_blank" rel="noopener noreferrer"><button>Comment on Github</button></a><br/></comments><script>const reactionEmojis={laugh:"&#x1F600","+1":"&#x1F44D","-1":"&#x1F44E",hooray:"&#x1F389",confused:"&#x1F615",heart:"&#x2665",rocket:"&#x1F680",eyes:"&#x1F440"};function domReady(e){document.addEventListener("DOMContentLoaded",e),"interactive"!==document.readyState&&"complete"!==document.readyState||e()}function countReactions(e){const t={};return e.forEach(e=>{t[e.content]?t[e.content]++:t[e.content]=1}),t}function formatReactions(e){if(!e.length)return"";const n=countReactions(e);return Object.keys(n).reduce((e,t)=>{return e+'<span class="comment-reaction-item">'+(reactionEmojis[t]||`:${t}:`)+"&nbsp"+n[t]+"</span>"},"")}function appendComments(e){const o=document.querySelector("comments"),t=document.getElementById("commentCounter");t&&(t.innerText=e.length||0),e&&e.forEach&&0!==e.length?e.forEach(function(e){var t=formatCommentDate(new Date(e.created_at)),t=`<a href="${e.user.html_url} rel="noopener noreferrer" target="_blank">${e.user.login}</a>`+" on "+`<a href="${e.html_url}" rel="noopener noreferrer" target="_blank">${t}</a>`;let n="";n+='<div class="comment">',n+='    <div class="comment-header">'+t+"</div>",n+='    <div class="comment-content">',n+='        <div class="comment-text">'+e.body_html+"</div>",0<e.reactions.length&&(n+='        <div class="comment-reactions">'+formatReactions(e.reactions)+"</div>"),n+="    </div>",n+="</div>",o.insertAdjacentHTML("beforeend",n)}):o.insertAdjacentHTML("beforeend","<p>No comments yet.</p>")}async function getComments(e){const t=await fetch(`https://api.github.com/repos/statox/blog-comments/issues/${e}/comments`,{method:"GET",mode:"cors",cache:"no-cache",headers:{Accept:"application/vnd.github.v3.html+json"}});return t.json()}async function getReactions(e){const t=await fetch(`https://api.github.com/repos/statox/blog-comments/issues/comments/${e}/reactions`,{method:"GET",mode:"cors",cache:"no-cache",headers:{Accept:"application/vnd.github.squirrel-girl-preview+json"}});return t.json()}function formatCommentDate(e){return`${e.getDate()}/${e.getUTCMonth()+1}/${e.getFullYear()}`}function setupCommentsInPage(t){domReady(async()=>{const e=await getComments(t);await Promise.all(e.map(async e=>{e.reactions=await getReactions(e.id)})),appendComments(e)})}function adaptToScreenSize(e){const t=new Date("Thu Apr 15 2021 00:00:00 GMT+0000 (Coordinated Universal Time)");let n=t.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),o="comments";e.matches&&(n=t.toLocaleDateString(void 0,{year:"numeric",month:"numeric",day:"numeric"}),o="üí¨"),document.getElementById("post_date").textContent=n,document.getElementById("comment_word").textContent=o}setupCommentsInPage(26);var x=window.matchMedia("(max-width: 500px)");adaptToScreenSize(x),x.addListener(adaptToScreenSize)</script></div><script data-goatcounter="https://statoxblog.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>